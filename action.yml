name: 'Go-Migrate-Action'
description: >
  A custom GitHub Action to build and run a Docker container for Go migrations in a Private
  Cloud SQL GCP environment.
author: 'Jack Perry'
inputs:
  GOMIGRATE_VERSION:
    description: 'Version of golang-migrate to use (e.g., v4.15.2)'
    required: true

  DB_USER:
    description: 'Database user with permissions to run migrations, pass this through as a GitHub secret for security'
    required: true

  DB_PASSWORD:
    description: 'Password for the database user, pass this through as a GitHub secret for security'
    required: true

  DB_NAME:
    description: 'Name of the database to run migrations against'
    required: true

  GCP_PROJECT_ID:
    description: 'GCP Project ID where the bastion VM and Cloud SQL instance are located, pass this through as a GitHub secret for security'
    required: true

  BASTION_VM_NAME:
    description: 'Name of the GCP VM instance to use as a bastion host'
    required: true

  BASTION_VM_ZONE:
    description: 'Zone where the GCP VM instance is located (e.g., us-central1-a)'
    required: true

  SSH_NAME:
    description: 'Name of the SSH name you would like to have when it SSHs into the bastion host'
    required: false
    default: 'github-action-go-migration'
  
runs:
  using: 'docker'
  image: 'Dockerfile'
  args:
    - ${{ inputs.GOMIGRATE_VERSION }}
    - ${{ inputs.DB_USER }}
    - ${{ inputs.DB_PASSWORD }}
    - ${{ inputs.DB_NAME }}
    - ${{ inputs.GCP_PROJECT_ID }}
    - ${{ inputs.BASTION_VM_NAME }}
    - ${{ inputs.BASTION_VM_ZONE }}
    - ${{ inputs.SSH_NAME }}
